---
title: unityShader入门精要
---

# 渲染基础介绍

## 基本渲染流水线

- 渲染流程分为 应用阶段，几何阶段，光栅化阶段

### 应用阶段
应用阶段由应用主导，通常在cpu上实现，主要任务是准备场景数据，进行粗剔除，设置渲染状态，输出渲染图元到几何阶段

### 几何阶段
这个阶段主要在GPU上实现，几何阶段需要处理每一个渲染图元，进行逐顶点，逐多边形操作，最后输出二维屏幕空间上的顶点坐标，顶点上包含了颜色，深度等信息，输出给下一个阶段使用


### 光栅化阶段
这个阶段负责用上一阶段的数据来生成屏幕上面的具体数据，光栅化决定了图元里面哪些像素该被绘制到屏幕上，以及通过逐顶点插值来决定像素的颜色

## CPU和GPU通信
- 渲染流水线的起点是CPU，CPU从硬盘将对应的网格纹理等数据读到内存中，然后再将这些数据存入显存中，然后设置渲染状态，再调用DrawCall来让GPU进行工作

### 设置渲染状态
- 渲染状态就是设置决定场景的中的网格究竟会被以什么方式渲染，这个时候可以设置着色器，纹理，Uniform等
- 渲染状态的频繁切换会导致比较高昂的cpu消耗

### draw call
draw call就是一个命令，cpu给定一个draw call，指挥gpu按设置好的渲染状态来进行渲染，最终输出成屏幕像素
- draw call的消耗比较高，每次需要进行渲染的状态切换，准备数据，资源绑定（设置顶点缓冲，材质参数等等）因此降低每帧渲染的draw call是性能优化的方向之一

### 合批
 合批就是降低draw call的有效手段之一，按照合批的分类可以分为静态合批，动态合批，GPUInstancing
- 静态合批指把场景中不动的物体（建筑，树木，地面）合并成一个大的Mesh
- 动态合批指运行中把很多小物体临时合并
- GPU Instancing指用同一套数据传不同参数来绘制大量相同或稍有不同的物体，这个优化在GPU端进行

## GPU流水线